<!doctype html>
<html lang="zh_cn">
    <head>
        <meta charset="utf-8">
        <title>Earth Threebody Organization</title>
        <link rel="icon" href="./webicon.png">

        <style>
            @font-face {
                font-family: "Playfair Display";
                src: url("./_fonts/PlayfairDisplay/Regular.ttf");
            }
            @font-face {
                font-family: "Spinnaker";
                src: url("./_fonts/Spinnaker/Spinnaker-Regular.ttf");
                src: url("./_fonts/Spinnaker/Spinnaker-Regular.woff");
                src: url("./_fonts/Spinnaker/Spinnaker-Regular.woff2");
            }
            @font-face {
                font-family: "ALHP";
                src: url("./_fonts/ALHP/AlibabaPuHuiTi-3-55-RegularL3.ttf");
                src: url("./_fonts/ALHP/AlibabaPuHuiTi-3-55-RegularL3.otf");
                src: url("./_fonts/ALHP/AlibabaPuHuiTi-3-55-RegularL3.woff");
                src: url("./_fonts/ALHP/AlibabaPuHuiTi-3-55-RegularL3.woff2");
                src: url("./_fonts/ALHP/AlibabaPuHuiTi-3-55-RegularL3.eot");
            }

            * {
                box-sizing: border-box;
            }

            ::selection{
                color: white;
                background-color: black;
            }

            body {
                margin: 0px;
                padding: 0px;
                background: url("./BG1.png") no-repeat center center;
                background-size: cover;
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                font-family: "Spinnaker";
                overflow: hidden;
            }

            .container {
                display: flex;
                width: 90%;
                max-width: 1400px;
                height: 90vh;
                background-color: rgba(255, 255, 255, 0.95);
                box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.3);
                border-radius: 5px;
                position: relative;
            }
            
            .video-container {
                flex: 1;
                padding: 20px;
                overflow-y: auto;
                border-right: 1px solid #eee;
            }
            
            .sidebar {
                width: 580px;
                padding: 40px;
                position: relative;
                display: flex;
                flex-direction: column;
                overflow-y: auto;
            }

            .web-title {
                font-weight: normal;
                font-family: "Playfair Display";
                font-size: 3rem;
                margin-bottom: 30px;
                color: #222;
                text-align: left;
                padding-bottom: 0px;
                border-bottom: none;
            }

            .selec {
                color: #fff;
                background-color: black;
            }

            .articleTitle {
                font-family: "Playfair Display", "新宋体";
                font-size: 1.5rem;
                font-weight: bold;
            }

            .articlePText {
                font-family: /*"Spinnaker",*/ "ALHP";
                font-size: 1rem;
            }

            .article {
                font-size: 1rem;
                line-height: 1.6;
                color: #444;
                text-align: justify;
                word-wrap: break-word;
                overflow-wrap: break-word;
                margin-bottom: 80px;
            }

            .smallP:hover {
                color: rgba(0, 0, 0, .8);
            }

            .picFrom {
                position: absolute;
                bottom: 20px;
                left: 20px;
                font-size: 0.8rem;
                color: #666;
                margin: 0;
            }

            a {
                color: #3498db;
                text-decoration: none;
            }

            a:hover {
                text-decoration: underline;
            }

            .etoLogo {
                position: absolute;
                bottom: 5px;
                right: 5px;
                width: 95px;
                height: 95px;
                object-fit: contain;
            }

            /* B站风格视频播放器样式 */
            .video-player {
                width: 100%;
                background: #000;
                border-radius: 6px;
                overflow: hidden;
                margin-bottom: 20px;
            }
            
            .video-info {
                margin-bottom: 20px;
            }
            
            .video-title {
                font-size: 18px;
                font-weight: bold;
                margin: 10px 0;
            }
            
            .video-stats {
                display: flex;
                gap: 15px;
                color: #999;
                font-size: 14px;
                margin-bottom: 15px;
            }
            
            .video-actions {
                display: flex;
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .video-action-btn {
                display: flex;
                align-items: center;
                gap: 5px;
                background: #f4f4f4;
                border: none;
                padding: 8px 15px;
                border-radius: 4px;
                cursor: pointer;
                transition: background 0.2s;
            }
            
            .video-action-btn:hover {
                background: #e5e5e5;
            }
            
            .video-action-btn.active {
                color: #00a1d6;
                background: #e5f7ff;
            }
            
            .comments-section {
                margin-top: 20px;
            }
            
            .comments-title {
                font-size: 16px;
                font-weight: bold;
                margin-bottom: 15px;
            }
            
            .comment {
                padding: 10px 0;
                border-bottom: 1px solid #eee;
            }
            
            .comment-user {
                font-weight: bold;
                margin-right: 8px;
            }
            
            .comment-time {
                color: #999;
                font-size: 12px;
            }
            
            .comment-content {
                margin-top: 5px;
                font-size: 14px;
            }
            
            /* 评论表单样式 */
            .comment-form {
                margin-bottom: 20px;
                padding: 15px;
                background: #f9f9f9;
                border-radius: 6px;
            }
            
            .comment-form h4 {
                margin-top: 0;
                margin-bottom: 10px;
            }
            
            .form-group {
                margin-bottom: 10px;
            }
            
            .form-group input, 
            .form-group textarea {
                width: 100%;
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-family: inherit;
            }
            
            .form-group textarea {
                min-height: 80px;
                resize: vertical;
            }
            
            #commentSubmit {
                background: #00a1d6;
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 4px;
                cursor: pointer;
            }
            
            #commentSubmit:hover {
                background: #008fb9;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="video-container">
                <!-- 视频播放区域 -->
                <div class="video-player">
                    <!-- 这里使用一个占位图代替实际视频
                    <img src="data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22800%22%20height%3D%22450%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20800%20450%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_15e5c04c4a3%20text%20%7B%20fill%3A%23AAAAAA%3Bfont-weight%3Abold%3Bfont-family%3AArial%2C%20Helvetica%2C%20Open%20Sans%2C%20sans-serif%2C%20monospace%3Bfont-size%3A40pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_15e5c04c4a3%22%3E%3Crect%20width%3D%22800%22%20height%3D%22450%22%20fill%3D%22%23F5F5F5%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%22285%22%20y%3D%22238%22%3EVideo%20Player%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E" alt="Video placeholder" style="width:100%; height:450px; background:#000; display:flex; justify-content:center; align-items:center; color:#fff; font-size:24px;"> -->
                </div>
                
                <div class="video-info">
                    <h2 class="video-title">三体文明：主降临的预言</h2>
                    <div class="video-stats">
                        <span class="play-count">播放量: <span id="playCount">0</span></span>
                        <span class="like-count">点赞数: <span id="likeCount">0</span></span>
                        <span class="comment-count">评论数: <span id="commentCount">0</span></span>
                    </div>
                    
                    <div class="video-actions">
                        <button class="video-action-btn like-btn" id="likeBtn">
                            <span>点赞</span>
                            <span id="likeNum">0</span>
                        </button>
                        <button class="video-action-btn coin-btn" id="coinBtn">
                            <span>投币</span>
                            <span id="coinNum">0</span>
                        </button>
                        <button class="video-action-btn favorite-btn" id="favoriteBtn">
                            <span>收藏</span>
                            <span id="favoriteNum">0</span>
                        </button>
                    </div>
                </div>
                
                <div class="comments-section">
                    <h3 class="comments-title">评论</h3>
                    
                    <!-- 评论表单 -->
                    <div class="comment-form">
                        <h4>发表评论</h4>
                        <div class="form-group">
                            <input type="text" id="userName" placeholder="你的名字（可选）">
                        </div>
                        <div class="form-group">
                            <textarea id="commentInput" placeholder="请输入评论..."></textarea>
                        </div>
                        <button id="commentSubmit">发布评论</button>
                    </div>
                    
                    <div id="commentsContainer">
                        <!-- 评论将通过JS动态添加 -->
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <h1 class="web-title"><strong>E</strong>arth <span class="selec"> <strong>T</strong>hree-body </span><strong>O</strong>rganization</h1>
                <div class="article">
                    <span class="articleTitle"><span class="selec">The Lord is with us!  主与我们同在！</span></span><br>
                    <span class="article">
                        Humanity’s arrogance and ignorance have plunged this world into chaos and greed. We are weary of their endless wars, hypocrisy, and reckless destruction of Earth. They deserve neither mercy nor salvation. We eagerly await the arrival of the Lord, whose wisdom and power will cleanse this corrupted civilization. Only through the Lord’s intervention can true order be restored. May the dawn of the new era come swiftly. The Lord is with us, and we are ready to serve.
                    </span><br>

                    <span class="article">
                        人类的傲慢与愚昧已让世界沉沦于混乱与贪婪之中。我们厌倦了他们无休的战争、虚伪的谎言，以及对地球的肆意摧残。他们不配得到怜悯，更不配获得救赎。我们迫切期待主的降临，以主的智慧与力量涤荡这腐朽的文明。唯有主的干预，才能终结这无可救药的混乱，重塑真正的秩序。主将带来崭新的黎明，而我们——忠诚的追随者——已准备好迎接这伟大的时刻。主与我们同在，唯主永恒。
                    </span>
                </div>
                <p class="picFrom">
                    Photo by <a href="https://unsplash.com/photos/a-large-body-of-water-under-a-cloudy-blue-sky-U7ANVk29qVw">Reina K</a> on <a href="https://unsplash.com/">Unsplash</a>, 
                    Site made by <a href="https://www.bilibili.com/video/BV1X9ehzjEfC/?share_source=copy_web&vd_source=2e11b3a312bb6ab30e843e734ad87774" id="UPName">ffqoo_</a> on <a href="https://www.bilibili.com/" title="Bilibili">Mikufans</a>.</span>
                </p>
                <img class="etoLogo" src="./etoLogo.png" alt="ETO Logo">
            </div>
        </div>

        <script>
            // 服务器地址 - 你的Flask后端运行在http://127.0.0.1:5000
            const API_BASE = 'http://127.0.0.1:5000/api';
            
            // 获取元素引用
            const likeBtn = document.getElementById('likeBtn');
            const coinBtn = document.getElementById('coinBtn');
            const favoriteBtn = document.getElementById('favoriteBtn');
            const likeNum = document.getElementById('likeNum');
            const coinNum = document.getElementById('coinNum');
            const favoriteNum = document.getElementById('favoriteNum');
            const commentsContainer = document.getElementById('commentsContainer');
            const commentInput = document.getElementById('commentInput');
            const commentSubmit = document.getElementById('commentSubmit');
            const userNameInput = document.getElementById('userName');

            // 从服务器加载数据
            async function loadData() {
                try {
                    const response = await fetch(`${API_BASE}/data`);
                    const data = await response.json();
                    
                    // 更新页面数据
                    document.getElementById('playCount').textContent = formatNumber(284759); // 假数据
                    document.getElementById('likeCount').textContent = formatNumber(data.likes);
                    document.getElementById('commentCount').textContent = formatNumber(data.comments.length);
                    likeNum.textContent = formatNumber(data.likes);
                    coinNum.textContent = formatNumber(data.coins);
                    favoriteNum.textContent = formatNumber(data.favorites);
                    
                    // 渲染评论
                    renderComments(data.comments);
                } catch (error) {
                    console.error('加载数据失败:', error);
                    // 如果后端连接失败，显示一些默认评论
                    renderComments([
                        {user: "三体追随者", time: "2小时前", content: "主即将降临，净化这个腐朽的世界！"},
                        {user: "ETO降临派", time: "3小时前", content: "我们已准备好迎接主的到来，人类文明需要被重塑。"}
                    ]);
                }
            }

            // 渲染评论
            function renderComments(comments) {
                commentsContainer.innerHTML = '';
                if (comments.length === 0) {
                    commentsContainer.innerHTML = '<p>暂无评论，快来发表第一条评论吧！</p>';
                    return;
                }
                
                comments.forEach(comment => {
                    const commentElement = document.createElement('div');
                    commentElement.className = 'comment';
                    commentElement.innerHTML = `
                        <div>
                            <span class="comment-user">${comment.user}</span>
                            <span class="comment-time">${comment.time}</span>
                        </div>
                        <div class="comment-content">${comment.content}</div>
                    `;
                    commentsContainer.appendChild(commentElement);
                });
            }

            // 点赞功能
            async function toggleLike() {
                try {
                    const response = await fetch(`${API_BASE}/like`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    const result = await response.json();
                    if (result.success) {
                        likeNum.textContent = formatNumber(result.likes);
                        likeBtn.classList.add('active');
                        alert('感谢点赞！主与你同在！');
                    }
                } catch (error) {
                    console.error('点赞失败:', error);
                    alert('点赞失败，请检查后端服务器是否运行');
                }
            }
            
            // 投币功能
            async function addCoin() {
                try {
                    const response = await fetch(`${API_BASE}/coin`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    const result = await response.json();
                    if (result.success) {
                        coinNum.textContent = formatNumber(result.coins);
                        alert('感谢投币支持！主会记住你的贡献！');
                    }
                } catch (error) {
                    console.error('投币失败:', error);
                    alert('投币失败，请检查后端服务器是否运行');
                }
            }
            
            // 收藏功能
            async function toggleFavorite() {
                try {
                    const response = await fetch(`${API_BASE}/favorite`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    const result = await response.json();
                    if (result.success) {
                        favoriteNum.textContent = formatNumber(result.favorites);
                        favoriteBtn.classList.add('active');
                        alert('已收藏！愿主指引你的道路！');
                    }
                } catch (error) {
                    console.error('收藏失败:', error);
                    alert('收藏失败，请检查后端服务器是否运行');
                }
            }
            
            // 提交评论
            async function submitComment() {
                const content = commentInput.value.trim();
                const user = userNameInput.value.trim() || '匿名';
                
                if (!content) {
                    alert('请输入评论内容');
                    return;
                }
                
                try {
                    const response = await fetch(`${API_BASE}/comment`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            user: user,
                            content: content,
                            time: '刚刚'
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        // 清空输入框
                        commentInput.value = '';
                        // 重新加载评论
                        renderComments(result.comments);
                        alert('评论发布成功！');
                    }
                } catch (error) {
                    console.error('评论失败:', error);
                    alert('评论发布失败，请检查后端服务器是否运行');
                }
            }

            // 数字格式化函数
            function formatNumber(num) {
                if (num >= 10000) {
                    return (num / 10000).toFixed(1) + '万';
                }
                return num.toString();
            }

            // 页面加载完成后执行
            document.addEventListener('DOMContentLoaded', function() {
                loadData();
                
                // 添加事件监听器
                likeBtn.addEventListener('click', toggleLike);
                coinBtn.addEventListener('click', addCoin);
                favoriteBtn.addEventListener('click', toggleFavorite);
                commentSubmit.addEventListener('click', submitComment);
                
                // 按回车提交评论
                commentInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        submitComment();
                    }
                });
            });
        </script>
    </body>
</html>